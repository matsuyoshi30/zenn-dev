---
title: "slog.LogValuer ã®å®Ÿè£…ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œã£ãŸ"
emoji: "ğŸ”–"
type: "tech"
topics: ["go"]
published: true
---

Go 1.21 ã§æ–°ãŸã« [log/slog](https://pkg.go.dev/log/slog) ã¨ã„ã†æ§‹é€ åŒ–ãƒ­ã‚®ãƒ³ã‚°ã®ãŸã‚ã®æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å†…å®¹ã‚„ä½¿ã„æ–¹ã¯ Go Doc ã‚„å…ˆæ—¥å…¬é–‹ã•ã‚ŒãŸ [Go Blog](https://go.dev/blog/slog) ãªã©ã§ç¢ºèªã§ãã¾ã™ã€‚

slog ã«ã¯ [slog.LogValuer](https://pkg.go.dev/log/slog#LogValuer) ã¨ã„ã†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ãŠã‚Šã€ã“ã®å®Ÿè£…ã‚’æº€ãŸã™ã“ã¨ã§ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹å†…å®¹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚Go Doc ã«ä¾‹ãŒã‚ã‚Šã¾ã™ãŒã€æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãŸã‚Šã€ãƒ­ã‚°ã«å‡ºåŠ›ã—ãŸããªã„å ´åˆã«ä»£ã‚ã‚Šã®æ–‡å­—ã‚’å‡ºåŠ›ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```go
type Name struct {
	First, Last string
}

func (n Name) LogValue() slog.Value {
	return slog.GroupValue(
		slog.String("first", n.First),
		slog.String("last", n.Last))
}

n := Name{"Perry", "Platypus"}
logger := slog.New(slog.NewTextHandler(os.Stdout, &slog.HandlerOptions{ReplaceAttr: func(groups []string, a slog.Attr) slog.Attr {
	if a.Key == slog.TimeKey && len(groups) == 0 {
		return slog.Attr{}
	}
	return a
}}))
logger.Info("mission accomplished", "agent", n)

// Output:
//
// level=INFO msg="mission accomplished" agent.first=Perry agent.last=Platypus

// JSON Output would look in part like:
// {
//     ...
//     "msg": "mission accomplished",
//     "agent": {
//         "first": "Perry",
//         "last": "Platypus"
//     }
// }
```

```go
type Token string

func (Token) LogValue() slog.Value {
	return slog.StringValue("REDACTED_TOKEN")
}

t := Token("shhhh!")
logger := slog.New(slog.NewTextHandler(os.Stdout, &slog.HandlerOptions{ReplaceAttr: func(groups []string, a slog.Attr) slog.Attr {
	if a.Key == slog.TimeKey && len(groups) == 0 {
		return slog.Attr{}
	}
	return a
}}))
logger.Info("permission granted", "user", "Perry", "token", t)

// Output:
//
// level=INFO msg="permission granted" user=Perry token=REDACTED_TOKEN
```

æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ãŸã‚ã«ã¯ã€`LogValue` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ãŸã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’åˆ—æŒ™ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã¤ã„ã¦ã€`slog.LogValuer` ã®å®Ÿè£…ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ç°¡æ˜“çš„ãªãƒ„ãƒ¼ãƒ« [Logvaluer](https://github.com/matsuyoshi30/logvaluer) ã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã§æŒ‡å®šã•ã‚ŒãŸå‹ã‚’æ¢ã—ã¦ `LogValue` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ç¾çŠ¶ã¯æ§‹é€ ä½“ã‚¿ã‚°ã«ã‚ˆã£ã¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‡ºåŠ›å¯¾è±¡å¤–ã«ã—ãŸã‚Šã€ãƒ­ã‚°ã«å€¤ã‚’å‡ºåŠ›ã—ãŸããªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ä»£æ›¿æ–‡å­—ã‚’å‡ºåŠ›ã—ãŸã‚Šã§ãã¾ã™ã€‚

ä¾‹ãˆã°ä»¥ä¸‹ã®æ§‹é€ ä½“ã«ã¤ã„ã¦ã¯

```go
type Foo struct {
	Str       string
	pstr      string
	IgnoreStr string `ignored:"true"`
	Passwd    string `mask:"true"`
	Flo       float64
	M         int
	N         int64
	L         uint64
	Flag      bool
	Date      time.Time
	Dur       time.Duration
}
```

ã“ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```go
func (f Foo) LogValue() slog.Value {
	return slog.GroupValue(
		slog.String("Str", f.Str),
		slog.String("pstr", f.pstr),
		slog.String("Passwd", "MASK"),
		slog.Float64("Flo", f.Flo),
		slog.Int("M", f.M),
		slog.Int64("N", f.N),
		slog.Any("L", f.L),
		slog.Bool("Flag", f.Flag),
		slog.Time("Date", f.Date),
		slog.Duration("Dur", f.Dur),
	)
}
```

ä»–ã®æ§‹é€ ä½“ã‚¿ã‚°ã‚’ä½¿ã£ã¦ãƒ­ã‚°å‡ºåŠ›ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã¨ã‚ˆã‚Šä¾¿åˆ©ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚json ã‚¿ã‚°ã‚’è¦‹ã‚‹ã‚ˆã†ã«ã—ãŸã‚Šã™ã‚‹ã¨ã‹
